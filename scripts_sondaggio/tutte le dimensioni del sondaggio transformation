select * from sondaggio.progetto_andromeda pa where pa.genere 

select fascia_eta from sondaggio.progetto_andromeda 


drop table if exists dim_genere;

create table dim_genere as 
select row_number() over () as ids_genere, * from (
	select distinct pa.genere 
	from sondaggio.progetto_andromeda pa
);

drop table if exists dim_fascia_eta;

create table dim_fascia_eta as 
 select row_number() over () as ids_fascia_eta, * from (
   select distinct pa.fascia_eta 
from sondaggio.progetto_andromeda pa

) t 
order by fascia_eta;

select * from dim_fascia_eta dfe

select * from dim_genere dg 

-- nella "grandezza_azienda" conviene un order by
-- adesso procediamo con la creazione della dim_provincia_domicilio

drop table if exists dim_provincia_domicilio;

create table dim_provincia_domicilio as 
 select row_number() over () as ids_provincia_domicilio, * from (
   select distinct pa.provincia_domicilio 
from sondaggio.progetto_andromeda pa
) t

drop table if exists dim_provincia_domicilio;
	
	create table dim_provincia_domicilio as 
	select row_number () over() , * from (select distinct 
	trim (INITCAP (
		case
        when provincia_domicilio = 'bo'
        	then 'bologna'
        when provincia_domicilio = 'rm'
        	then 'roma'
        when provincia_domicilio = 'mn'
        	then 'mantova'
        when provincia_domicilio = 'villamaina(av)'
        	then 'avellino'
        when provincia_domicilio = 'via del giardinetto 30 marlia'
        	then 'lucca'
        when provincia_domicilio = 'tunisi'
        	then 'estero'
        when provincia_domicilio = 'forlì cesena'
        	then 'forlì-cesena'
        else provincia_domicilio 
        end   )
                
	) as provincia_domicilio from (select trim(lower(provincia_domicilio)) as provincia_domicilio
	from sondaggio.progetto_andromeda pa)
	order by provincia_domicilio) t;

select * from dim_provincia_domicilio

-- adesso procediamo con la "dim_grandezza_azienda"

drop table if exists dim_grandezza_azienda;

create table dim_grandezza_azienda as 
 select row_number() over () as ids_grandezza_azienda, * from (
   select distinct pa.grandezza_azienda 
from sondaggio.progetto_andromeda pa
) t
order by grandezza_azienda; -- ho inserito l'order by perchè c'è una variazione di numeri

-- creazione della "dim_durata_lavoro_in_azienda"

drop table if exists dim_durata_lavoro_in_azienda;

create table dim_durata_lavoro_in_azienda  as 
 select row_number() over () as ids_durata_lavoro_in_azienda, * from (
   select distinct pa.durata_lavoro_in_azienda 
from sondaggio.progetto_andromeda pa

) t 
order by durata_lavoro_in_azienda;

-- creazione dim_provincia_ultimo_lavoro

drop table if exists dim_provincia_ultimo_lavoro;

create table dim_provincia_ultimo_lavoro  as 
 select row_number() over () as ids_provincia_ultimo_lavoro, * from (
   select distinct pa.provincia_ultimo_lavoro
from sondaggio.progetto_andromeda pa

) t 
order by provincia_ultimo_lavoro;

-- creazione dim_vittima_o_testimone_in_azienda

drop table if exists dim_vittima_o_testimone_di_discriminazione_in_azienda;

create table dim_vittima_o_testimone_di_discriminazione_in_azienda   as 
 select row_number() over () as ids_vittima_o_testimone_di_discriminazione_in_azienda, * from (
   select distinct pa.vittima_o_testimone_di_discriminazione_in_azienda
from sondaggio.progetto_andromeda pa

) t 
order by vittima_o_testimone_di_discriminazione_in_azienda;

-- creazione dim_tipo_discriminazione

drop table if exists dim_tipo_discriminazione;

create table dim_tipo_discriminazione as 
select row_number() over () as ids_tipo_discriminazione, * from (
select distinct pa.tipo_discriminazione
from sondaggio.progetto_andromeda pa

) t;
-- qui c'è l'inserimento della dimensione
-- con il fittizio 'nessuna discriminazione indicata'
-- comunque c'è un problema con i valori

drop table if exists dim_tipo_discriminazione;

create table dim_tipo_discriminazione AS
select  row_number () over(
	 order by (valore_discriminazione = 'Nessuna discriminazione indicata')
	desc, valore_discriminazione) as ids_tipo_discrizimazione,
	valore_discriminazione as tipo_discriminazione from
	(select distinct coalesce(nullif(trim(pa.tipo_discriminazione), ''), 'Nessuna discriminazione indicata')
as valore_discriminazione from sondaggio.progetto_andromeda pa
) t;

-- creazione dim_vittima_o_testimone_di_violenza

drop table if exists dim_vittima_o_testimone_di_violenza;

create table dim_vittima_o_testimone_di_violenza as 
select row_number() over () ids_vittima_o_testimone_di_violenza, * from (
select distinct pa.vittima_o_testimone_di_violenza
from sondaggio.progetto_andromeda pa

) t;

-- creazione dim_tipo_violenza

drop table if exists dim_tipo_violenza;

create table dim_tipo_violenza as 
select row_number() over () ids_tipo_violenza, * from (
select distinct pa.tipo_violenza
from sondaggio.progetto_andromeda pa

) t;

-- creazione dim_presenza_formazione_antidiscriminazione_in_azienda

drop table if exists dim_presenza_formazione_antidiscriminazione_in_azienda;

create table dim_presenza_formazione_antidiscriminazione_in_azienda as 
select row_number() over () ids_presenza_formazione_antidiscriminazione_in_azienda, * from (
select distinct pa.presenza_formazione_antidiscriminazione_in_azienda
from sondaggio.progetto_andromeda pa

) t;

-- creazione dim_presenza_regolamenti_antidiscriminazione

drop table if exists dim_presenza_regolamenti_antidiscriminazione;

create table dim_presenza_regolamenti_antidiscriminazione as 
select row_number() over () ids_presenza_regolamenti_antidiscriminazione, * from (
select distinct pa.presenza_regolamenti_antidiscriminazione
from sondaggio.progetto_andromeda pa

) t;